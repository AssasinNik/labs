spring.application.name=gateway
server.port=8080

# Routes Configuration
spring.cloud.gateway.routes[0].id=lab-1-service
spring.cloud.gateway.routes[0].uri=http://localhost:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/lab1/**
spring.cloud.gateway.routes[0].filters[0]=RewritePath=/api/lab1/(?<segment>.*), /api/$\{segment}
spring.cloud.gateway.routes[0].filters[1]=RemoveRequestHeader=Cookie
spring.cloud.gateway.routes[0].filters[2]=name=CircuitBreaker,args.name=lab1ServiceBreaker,args.fallbackUri=forward:/fallback/lab1

# Common Gateway Configuration
spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping=true
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*

# Authentication exclusion paths (JWT)
gateway.auth.exclude-paths=/api/lab1/auth/login,/api/lab1/auth/register,/api/lab1/auth/refresh-token 

# JWT Configuration
jwt.secret=${JWT_SECRET_BASE64:bXktc3VwZXItc2VjcmV0LWtleS1mb3ItandoLXRva2Vucy1nZW5lcmF0aW9uLW5vYm9keS1ndWVzcw==}
jwt.expiration=3600000
jwt.refresh-expiration=86400000

# Redis Configuration
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.database=0
spring.data.redis.timeout=10000
spring.data.redis.repositories.enabled=false

# Resilience4j Circuit Breaker Configuration
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.sliding-window-size=10
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.wait-duration-in-open-state=10000
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.slow-call-rate-threshold=50
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.slow-call-duration-threshold=2000

# Resilience4j Time Limiter
resilience4j.timelimiter.instances.lab1ServiceBreaker.timeout-duration=3000
resilience4j.timelimiter.instances.lab1ServiceBreaker.cancel-running-future=true

# Rate Limiting (lab-1)
spring.cloud.gateway.routes[0].filters[3]=name=RequestRateLimiter,args.redis-rate-limiter.replenishRate=50,args.redis-rate-limiter.burstCapacity=100,args.key-resolver=#{@ipKeyResolver}

# Logging Configuration
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.http.server.reactive=DEBUG
logging.level.org.springframework.web.reactive=DEBUG
logging.level.reactor.netty=DEBUG
logging.level.com.cherenkov=DEBUG

# MDC and structured logging
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [trace:%X{X-Correlation-ID:-N/A}] %-5level %logger{36} - %msg%n
logging.file.name=logs/gateway.log
logging.file.max-size=10MB
logging.file.max-history=10

# Actuator
management.endpoints.web.exposure.include=health,info,metrics,gateway,circuitbreakers
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
