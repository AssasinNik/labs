spring.application.name=gateway
server.port=8080

# Routes Configuration
spring.cloud.gateway.routes[0].id=lab-1-service
spring.cloud.gateway.routes[0].uri=http://localhost:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/**
spring.cloud.gateway.routes[0].filters[0]=RemoveRequestHeader=Cookie
spring.cloud.gateway.routes[0].filters[1]=CircuitBreaker=lab1ServiceBreaker,forward:/fallback/lab1
spring.cloud.gateway.routes[0].filters[2]=AddRequestHeader=X-Gateway-Auth,true

spring.cloud.gateway.routes[1].id=lab1-reports-service
spring.cloud.gateway.routes[1].uri=http://localhost:8081
spring.cloud.gateway.routes[1].predicates[0]=Path=/reports/attendance/**
spring.cloud.gateway.routes[1].filters[0]=RemoveRequestHeader=Cookie
spring.cloud.gateway.routes[1].filters[1]=CircuitBreaker=lab1ServiceBreaker,forward:/fallback/lab1
spring.cloud.gateway.routes[1].filters[2]=AddRequestHeader=X-Gateway-Auth,true

# Routes Configuration - lab_2
spring.cloud.gateway.routes[2].id=lab-2-service
spring.cloud.gateway.routes[2].uri=http://localhost:8082
spring.cloud.gateway.routes[2].predicates[0]=Path=/lab2/api/**
spring.cloud.gateway.routes[2].filters[0]=RemoveRequestHeader=Cookie
spring.cloud.gateway.routes[2].filters[1]=CircuitBreaker=lab2ServiceBreaker,forward:/fallback/lab2
spring.cloud.gateway.routes[2].filters[2]=AddRequestHeader=X-Gateway-Auth,true
spring.cloud.gateway.routes[2].filters[3]=RewritePath=/lab2/api/(?<segment>.*), /api/$\{segment}

spring.cloud.gateway.routes[3].id=lab2-reports-service
spring.cloud.gateway.routes[3].uri=http://localhost:8082
spring.cloud.gateway.routes[3].predicates[0]=Path=/reports/course/**
spring.cloud.gateway.routes[3].filters[0]=RemoveRequestHeader=Cookie
spring.cloud.gateway.routes[3].filters[1]=CircuitBreaker=lab2ServiceBreaker,forward:/fallback/lab2
spring.cloud.gateway.routes[3].filters[2]=AddRequestHeader=X-Gateway-Auth,true

# CORS Configuration
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*

# Пути, исключенные из проверки JWT
gateway.auth.exclude-paths=/api/auth/login,/api/auth/register,/api/auth/refresh-token,/actuator/**,/fallback/**

# JWT Configuration
jwt.secret=${JWT_SECRET_BASE64:bXktc3VwZXItc2VjcmV0LWtleS1mb3ItandoLXRva2Vucy1nZW5lcmF0aW9uLW5vYm9keS1ndWVzcw==}
jwt.expiration=3600000
jwt.refresh-expiration=86400000

# Gateway Config
gateway.auth.header-name=X-Gateway-Auth
gateway.auth.header-value=true
gateway.auth.forwarded-header=true

# Resilience4j Circuit Breaker Configuration - lab_1
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.sliding-window-size=10
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.wait-duration-in-open-state=10000
resilience4j.circuitbreaker.instances.lab1ServiceBreaker.permitted-number-of-calls-in-half-open-state=5

# Resilience4j Circuit Breaker Configuration - lab_2
resilience4j.circuitbreaker.instances.lab2ServiceBreaker.sliding-window-size=10
resilience4j.circuitbreaker.instances.lab2ServiceBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.lab2ServiceBreaker.wait-duration-in-open-state=10000
resilience4j.circuitbreaker.instances.lab2ServiceBreaker.permitted-number-of-calls-in-half-open-state=5

# Resilience4j Time Limiter - lab_1
resilience4j.timelimiter.instances.lab1ServiceBreaker.timeout-duration=3000
resilience4j.timelimiter.instances.lab1ServiceBreaker.cancel-running-future=true

# Resilience4j Time Limiter - lab_2
resilience4j.timelimiter.instances.lab2ServiceBreaker.timeout-duration=3000
resilience4j.timelimiter.instances.lab2ServiceBreaker.cancel-running-future=true

# Logging Configuration
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=INFO
logging.level.org.springframework.security=INFO
logging.level.com.cherenkov=INFO

# MDC and structured logging
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [trace:%X{X-Correlation-ID:-N/A}] %-5level %logger{36} - %msg%n
logging.file.name=logs/gateway.log
logging.file.max-size=10MB
logging.file.max-history=10

# Actuator
management.endpoints.web.exposure.include=health,info,metrics,gateway,circuitbreakers
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
